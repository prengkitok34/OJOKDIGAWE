<?php
// Konfigurasi Mailcow API
$mailcow_api = "https://mail.mailxstres.org/api/v1/add/mailbox";
$api_key = "41109F-37B565-C9782E-484E0A-DBB6C1"; // ganti dengan milikmu
$domain = "mailxstres.org";

// Fungsi buat username random
function generateRandomUsername($length = 8) {
    $chars = 'abcdefghijklmnopqrstuvwxyz0123456789';
    $username = '';
    for ($i = 0; $i < $length; $i++) {
        $username .= $chars[rand(0, strlen($chars) - 1)];
    }
    return $username;
}

$username = generateRandomUsername();
$password = bin2hex(random_bytes(6)); // password random

// Payload untuk request API
$data = [
    "local_part" => $username,
    "domain" => $domain,
    "name" => $username,
    "password" => $password,
    "quota" => 1024, // dalam MB
    "active" => 1,
    "tls_enforce_in" => true,
    "tls_enforce_out" => true
];

// Kirim request POST ke Mailcow API
$ch = curl_init($mailcow_api);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
curl_setopt($ch, CURLOPT_HTTPHEADER, [
    "X-API-Key: $api_key",
    "Content-Type: application/json"
]);
curl_setopt($ch, CURLOPT_POST, true);
curl_setopt($ch, CURLOPT_POSTFIELDS, json_encode($data));

$response = curl_exec($ch);
$http_status = curl_getinfo($ch, CURLINFO_HTTP_CODE);
curl_close($ch);

// Tampilkan hasil
if ($http_status == 200) {
    echo "✅ Email berhasil dibuat:\n";
    echo "📧 Email: {$username}@{$domain}\n";
    echo "🔑 Password: {$password}\n";
} else {
    echo "❌ Gagal membuat email. HTTP Status: $http_status\n";
    echo "Respon: $response\n";
}
?>
